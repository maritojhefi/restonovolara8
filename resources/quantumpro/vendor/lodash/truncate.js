var baseToString=require("./_baseToString"),castSlice=require("./_castSlice"),hasUnicode=require("./_hasUnicode"),isObject=require("./isObject"),isRegExp=require("./isRegExp"),stringSize=require("./_stringSize"),stringToArray=require("./_stringToArray"),toInteger=require("./toInteger"),toString=require("./toString"),DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",reFlags=/\w*$/;function truncate(e,r){var i=DEFAULT_TRUNC_LENGTH,t=DEFAULT_TRUNC_OMISSION;if(isObject(r)){var n="separator"in r?r.separator:n;i="length"in r?toInteger(r.length):i,t="omission"in r?baseToString(r.omission):t}var s=(e=toString(e)).length;if(hasUnicode(e)){var a=stringToArray(e);s=a.length}if(s<=i)return e;var o=i-stringSize(t);if(o<1)return t;var g=a?castSlice(a,0,o).join(""):e.slice(0,o);if(void 0===n)return g+t;if(a&&(o+=g.length-o),isRegExp(n)){if(e.slice(o).search(n)){var c,l=g;for(n.global||(n=RegExp(n.source,toString(reFlags.exec(n))+"g")),n.lastIndex=0;c=n.exec(l);)var u=c.index;g=g.slice(0,void 0===u?o:u)}}else if(e.indexOf(baseToString(n),o)!=o){var S=g.lastIndexOf(n);-1<S&&(g=g.slice(0,S))}return g+t}module.exports=truncate;