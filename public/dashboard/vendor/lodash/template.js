var assignInWith=require("./assignInWith"),attempt=require("./attempt"),baseValues=require("./_baseValues"),customDefaultsAssignIn=require("./_customDefaultsAssignIn"),escapeStringChar=require("./_escapeStringChar"),isError=require("./isError"),isIterateeCall=require("./_isIterateeCall"),keys=require("./keys"),reInterpolate=require("./_reInterpolate"),templateSettings=require("./templateSettings"),toString=require("./toString"),reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g;function template(s,e,r){var t=templateSettings.imports._.templateSettings||templateSettings;r&&isIterateeCall(s,e,r)&&(e=void 0),s=toString(s),e=assignInWith({},e,t,customDefaultsAssignIn);var p,o,n=assignInWith({},e.imports,t.imports,customDefaultsAssignIn),i=keys(n),a=baseValues(n,i),u=0,l=e.interpolate||reNoMatch,g="__p += '",_=RegExp((e.escape||reNoMatch).source+"|"+l.source+"|"+(l===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(e.evaluate||reNoMatch).source+"|$","g"),c="sourceURL"in e?"//# sourceURL="+e.sourceURL+"\n":"";s.replace(_,function(e,r,t,n,i,a){return t||(t=n),g+=s.slice(u,a).replace(reUnescapedString,escapeStringChar),r&&(p=!0,g+="' +\n__e("+r+") +\n'"),i&&(o=!0,g+="';\n"+i+";\n__p += '"),t&&(g+="' +\n((__t = ("+t+")) == null ? '' : __t) +\n'"),u=a+e.length,e}),g+="';\n";var m=e.variable;m||(g="with (obj) {\n"+g+"\n}\n"),g=(o?g.replace(reEmptyStringLeading,""):g).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),g="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(p?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var S=attempt(function(){return Function(i,c+"return "+g).apply(void 0,a)});if(S.source=g,isError(S))throw S;return S}module.exports=template;